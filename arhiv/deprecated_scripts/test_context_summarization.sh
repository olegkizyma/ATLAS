#!/bin/bash

# Test Smart Context Summarization System
echo "üß† –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Smart Context Summarization System..."

# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –ø—Ä–∞—Ü—é—î —Å–µ—Ä–≤–µ—Ä
echo "üì° –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ orchestrator..."
if curl -s http://127.0.0.1:5101/context/stats >/dev/null 2>&1; then
    echo "‚úÖ Orchestrator –ø—Ä–∞—Ü—é—î"
else
    echo "‚ùå Orchestrator –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ó–∞–ø—É—Å–∫–∞—é..."
    cd /Users/dev/Documents/GitHub/ATLAS
    source context_limits.env
    ./start_stack.sh &
    sleep 5
fi

# 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
echo "üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É:"
curl -s http://127.0.0.1:5101/context/stats | jq .

# 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –≤–µ–ª–∏–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
echo "üîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –≤–µ–ª–∏–∫–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º..."
TEST_MESSAGE="–¶–µ –¥—É–∂–µ –¥–æ–≤–≥–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫–µ –ø–æ–≤–∏–Ω–Ω–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–æ–±–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É. –¶—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤–∏–Ω–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥—Å—É–º–æ–≤—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–∏—à–µ –æ—Å—Ç–∞–Ω–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó –ø–ª—é—Å –ø—ñ–¥—Å—É–º–æ–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö. $(for i in {1..100}; do echo -n "–¢–µ—Å—Ç–æ–≤–∏–π —Ç–µ–∫—Å—Ç –Ω–æ–º–µ—Ä $i –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. "; done)"

curl -X POST http://127.0.0.1:5101/chat/stream \
  -H "Content-Type: application/json" \
  -d "{\"message\":\"$TEST_MESSAGE\",\"sessionId\":\"test-context-session\"}" \
  2>/dev/null | head -20

# 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
echo "üìà –°—Ç–∞–Ω –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏:"
curl -s http://127.0.0.1:5101/context/stats | jq .

# 5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
echo "üìù –§–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:"
curl -s http://127.0.0.1:5101/context/formatted | jq .formattedContext | head -10

echo "‚ú® –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
