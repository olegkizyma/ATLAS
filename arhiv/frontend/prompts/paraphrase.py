def build_directive(user_message: str) -> str:
    """Строит директиву (серверное перефразирование) без LLM.

    Принципы: автономность, отсутствие дополнительных подтверждений, выбор безопасных опций,
    доведение до результата и краткий итог.
    """
    msg = (user_message or "").strip()
    rules = [
        "Працюю автономно, не прошу додаткових підтверджень.",
        "Якщо потрібен вибір — приймаю обґрунтоване і безпечне рішення самостійно.",
        "Уникаю зайвих пауз, доводжу задачу до завершення.",
        "Перевіряю результат і надаю стислий підсумок наприкінці.",
    ]
    steps = [
        "Уточнити внутрішньо вимоги і критерії готовності (Definition of Done).",
        "Розбити задачу на конкретні кроки і виконати їх послідовно.",
        "За потреби: самостійно обрати інструменти/ресурси і продовжити без запитань.",
        "Верифікувати отриманий результат і зафіксувати короткий підсумок.",
    ]
    rules_lines = "\n".join(f"- {r}" for r in rules)
    steps_lines = "\n".join(f"- {s}" for s in steps)
    directive = (
        "Я беру на себе виконання завдання повністю і автономно.\n"
        "Правила:\n"
        f"{rules_lines}\n"
        "План дій:\n"
        f"{steps_lines}\n"
        "Оригінальний запит користувача (контекст, не для цитування як є): " + msg
    )
    return directive
