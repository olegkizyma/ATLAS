# Інтеграція системи обміну чатами з Goose і системою Atlas

Цей документ містить опис інтеграції потокового функціоналу між чатом (Goose) і системою Atlas. Нижче наведено аналіз, рекомендації та приклади коду.

---

## 1. Конфігурація клієнта та сервера

### **1.1 GooseClient**
- Використовується для зв’язку з API Goose через WebSocket або Server-Sent Events (SSE).
- Файл: `goose_client.py`

#### Основний код ініціалізації:
```python
from services.goose_client import GooseClient

goose_client = GooseClient(base_url="http://127.0.0.1:3000", secret_key="your-secret-key")
response = goose_client.send_reply(session_name="test-session", message="Привіт")
print(response)
```

### **1.2 Серверна обробка запитів**
#### Обробник чату (SSE):
- Файл: `handlers/chat.py`
- Метод: `handle_chat_stream`
- Призначення: Приймає HTTP-запити, надсилає потокові події через `ChatStreamer`.

```python
def handle_chat_stream(h):
    ...
    streamer = ChatStreamer(h.goose_client)
    for event in streamer.stream(payload, goose_base_url=h.goose_api_url):
        h.wfile.write(f"data: {event}\n\n".encode('utf-8'))
```

---

## 2. Потоковий вивід (Streaming)

### **2.1 КомпONENTS**

#### `ChatContext`
- Глобальний контекст для обробки станів чату.
- Файл: `contexts/ChatContext.tsx`

#### `ProgressiveMessageList`
- Компонент для рендерингу потокових даних у реальному часі.
- Файл: `ProgressiveMessageList.tsx`

---

## 3. Код прикладу

### **Клієнт (WebSocket)**
```tsx
import React, { useState, useEffect } from "react";

const StreamingChat = () => {
  const [output, setOutput] = useState("");
  useEffect(() => {
    const ws = new WebSocket("ws://localhost:3000/ws");
    ws.onmessage = (event) => setOutput((prev) => prev + event.data);

    return () => ws.close();
  }, []);

  return <div>{output}</div>;
};
export default StreamingChat;
```

---

## 4. Рекомендації

1. **Валідація:** Обробка помилкових запитів на сервері (e.g., відсутність `message`).
2. **Реальний час:** Використання WebSocket пріоритетно над SSE для інтерактивності.
3. **Логування:** Додати докладне логування всіх потокових подій.
